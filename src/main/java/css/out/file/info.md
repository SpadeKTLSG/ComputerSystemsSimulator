曹文星的 文件管理

# 设计要求

Java实现一个简单的文件系统模块, 假设内存, 进程, 设备等模块已经开发完毕, 不用考虑界面展示问题

警告: 禁止实现超出要求的功能

# 问题解决

* 判断文件重名问题
    * 通过包含该文件的目录信息判断
* 判断文件对应块数问题 有几个块，放哪里空位置
    * 通过文件长度判断, 一个块64B.
* 10还是1 0问题
    * 我用键值对实现就好, 一行一组就不用怕了
* 注意空间多次分配问题
    * 每次刷新即可

# 主要概念

## 磁盘  disk.txt

128块×64B每个 = 8KB 显式链接分配

空闲存储空间管理采用位示图

### 位示图

表示磁盘一个盘块使用情况

“0”空闲, “1”分配

分配过程-> 顺序扫描位示图，找到一个或一组代表空闲盘块的二进制位

实现: 后端直接拉平二维转一维, 需要前端展示的时候直接转回二维

内容

* 0块 64字节 FAT1
* 1块 64字节 FAT2
* 2块  **系统根目录**，限制其最大创建数量（FCB大小限制 8个）
* 3-127块 文件相关内容

### FAT文件分配表

= 位示图 + 显示链接的指针(每个指向下一个项, 没有就赋值为514代表结束) 64项/个, 共两个 占用两项128字节对应一个磁盘块
利用一行一个键值对实现 {第几项:内容}

## 目录/文件

### FCB文件控制块

8B绑定文件头, 用于描述文件的基本信息

* 文件名+目录名 3B
* 扩展名 2B （目录为空）
* 文件目录标识 1B 0/1/2...
* 起始盘块号 1B
* 文件长度 1B （目录为空）

### 根子目录

固定为磁盘第三块, 仿linux目录结构

* home 用户子目录
* app 应用程序目录
* tmp 临时可变目录
* conf 配置文件目录
* mnt 设备挂载目录
* bin 可执行命令目录
* lib 系统库文件以及系统资料目录
* boot 系统内核程序目录

子目录 位置不固定，大小不固定, 支持多级子目录

### 文件 XXX.txt

清空方法 无需擦除，直接标记不存在

采用流式结构: 将数据按顺序组织成记录集合并积累保存，以字节(Byte)为单位(字节为传输单位)

因此一次输入的为最大大小255个字符 `(2的8次方) 11111111 - 00000000 8位=1B`

交互式控制用户一次输入文本最大长度255, 当发现输入长度超过255时, 会自动分配下一个盘块, 并将上一个盘块的最后一个字节的值改为下一个盘块的盘块号

#### #XXX.txt 可执行文件#开头

实现的**命令列表**

* x=?; 给x赋值一位数
* x++; x加1
* x--; x减1
* !??； 第一个？为A,B,C中某个设备，第二个？为一位数，表示使用设备的时间；
* end. 表示文件结束，同时将结果写入文件**OUT.txt**，其中包括文件路径名和x的值。

# 主要方法

见API包

# 提供接口功能

用户接口提供用户命令接口

创建文件：create

拷贝文件：copy

删除文件：delete

移动文件：move

显示文件：type

改变文件属性：change

建立目录：makdir

改变目录路径：chadir

删除目录：deldir

(DLC)嵌套回收 类似rmdir -指令，里面的依次删除

运行可执行文件：可执行文件的文件名（创建进程）
